<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#F8F8F8" />
    <link rel="preconnect" href="https://rsms.me/">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="../css/home.css">
    <link rel="manifest" href="../manifest.json"/>
</head>
<body>
  <div class="bar">
    <a class="circle" href="./settings.html"><img style="-webkit-tap-highlight-color: transparent;" src="../library/icon-set.svg"></a>
    <div class="seleccion">
    <div class="search-icon"><img src="../library/icon-magnifying-glass.svg"></div>
    <input type="text" id="searchbar" class="search">
    </div>
    <a class="circle" href="editor.html"><img style="-webkit-tap-highlight-color: transparent;" src="../library/icon-plus.svg"></a>
  </div>
  <a href="https://w.cecyteq.edu.mx/" class="celda">
    <div class="conjunto"><div class="celda-icon"><img class="cecy" src="../library/cecyte.png"></div><div class="label">CECyTEQ</div></div>
    <img src="../library/icon-linking.svg" class="linking">
  </a>
  <div class="heading">Anuncios</div>

  <div id="anuncios_list"></div>
 <script>
    window.onload = () => {
      const nombre = localStorage.getItem('nombre');
      const semestre = localStorage.getItem('semestre');
      const especialidad = localStorage.getItem('especialidad');
      const turno = localStorage.getItem('turno');
      const matricula = localStorage.getItem('matricula');

      if (!nombre || !semestre || !especialidad || !turno || !matricula) {
        window.location.href = "login.html";
      }
    };

  async function mostrar() {
  const res = await fetch('/anuncios');
  const anuncios = await res.json();
  const cont = document.getElementById('anuncios_list');
 
  anuncios.forEach(item => {
    const fechaObj = new Date(item.fecha);
    const opcionesFecha = { day: 'numeric', month: 'long', year: 'numeric' };
    const fechaFormateada = fechaObj.toLocaleDateString('es-MX', opcionesFecha);

    const anuncioview = document.createElement('div');
    anuncioview.className = 'anuncio-item';
    anuncioview.innerHTML = `
      <a href="./anuncio.html?id=${item.id}" class="anuncio-view">
        <div class="titulo">${item.titulo}</div>
        <div class="contenido">${item.contenido.replace(/\n/g, '<br>')}</div>
        <div class="date">${fechaFormateada}</div>
      </a>
    `;
    cont.appendChild(anuncioview);
  });
}
  mostrar();

  const input = document.getElementById('searchbar');
  const lista = document.getElementById('anuncios_list');

  input.addEventListener('keyup', function() {
    const filtro = input.value.toLowerCase();
    const anuncios = lista.getElementsByClassName('anuncio-item');

    for (let i = 0; i < anuncios.length; i++) {
      const contenidoDiv = anuncios[i].querySelector('.contenido');
      const texto = contenidoDiv ? contenidoDiv.textContent.toLowerCase() : '';

      if (texto.includes(filtro)) {
        anuncios[i].style.display = ''; 
      } else {
        anuncios[i].style.display = 'none'; 
      }
    }
  }); 
</script>
<script src="../main.js"></script>
</body>
</html>

